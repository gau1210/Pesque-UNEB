<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Search usando Jquery, Ajax, Python Flask e Banco de Dados PostgreSQL</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link href="/static/css/estilo.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript">
$(function() {
  $(".search_button").click(function() {
    var search_word = $("#search_box").val();
    var dataString = 'search_word=' + search_word;
    if (search_word == '') {
      // Se a caixa de busca estiver vazia, não faça nada.
    } else {
      $.ajax({
        type: "POST",
        url: "/searchdata",
        data: dataString,
        cache: false,
        beforeSend: function(html) {
          document.getElementById("insert_search").innerHTML = '';
          $("#flash").show();
          $("#searchword").show();
          $(".searchword").html(search_word);
          $("#flash").html('<img src="/static/img/loader.gif" align="absmiddle"> Loading Results...');
        },
        success: function(html) {
          $("#insert_search").show();
          $("#insert_search").append(html.data);
          // Adiciona o link de download do CSV
          if (html.csv_url) {
            var downloadButton = '<a href="' + html.csv_url + '" class="btn btn-primary" type="button">Baixar CSV <i class="fa fa-file-csv"></i></a>';
            $("#insert_search").append(downloadButton);
          }
          $("#flash").hide();
        }
      });
    }
    return false;
  });
});
</script>
</head>
<div align="center">
  <div style="width:700px">
  <div style="margin-top:20px; text-align:left">
    <p align="center"><h1>PESQUE-UNEB </h1></p>
    <form method="get" action="">
    <input type="text" name="search" id="search_box" class='search_box'/>
    <input type="submit" value="Search" class="search_button" /><br />
    <span style="color:#666666; font-size:14px; font-family:Arial, Helvetica, sans-serif;"><b>Ex :</b> Ciência de Dados</span>
    </form>
  </div>
  <div>
    <div id="searchword">Search results for <span class="searchword"></span></div>
    <div id="flash"></div>
    <ol id="insert_search" class="update"></ol>
  </div>
  </div>
</div>
</body>
</html>